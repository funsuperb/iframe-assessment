<html>
<head>
    <title>ระบบประเมินการปฏิบัติงาน</title>
    <link rel="icon" type="image/x-icon" href="https://img5.pic.in.th/file/secure-sv1/sirindhorn-logo-png.png">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
        }

        iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
    </style>
</head>
<body>
    <iframe 
        id="appFrame" 
        src="https://script.google.com/macros/s/AKfycbxJ7vm1-nyIJan5mNKHvFQU8T2YiGVJo_sYjCxQJDB1ULrsqeSeaqr17TIumJG2A_o2/exec" 
        allow="clipboard-write allow-same-origin allow-scripts">
    </iframe>
    <script>
        function sendMessage() {
            let iframe = document.getElementById("appFrame");
            if (iframe && iframe.contentWindow) {
                iframe.contentWindow.postMessage({ enableRememberMe: true }, "*");
            }
        }

        window.onload = function() {
            let iframe = document.getElementById("appFrame");

            // ใช้ setInterval เพื่อส่ง message ซ้ำจนกว่า Safari จะทำงานถูกต้อง
            let interval = setInterval(() => {
                sendMessage();
            }, 500);

            // หยุด interval เมื่อ iframe โหลดสำเร็จ
            iframe.onload = function() {
                setTimeout(() => {
                    sendMessage();
                    clearInterval(interval);
                }, 500);
            };

            // กระตุ้น Safari ให้แสดงหน้าต่างบันทึกรหัสผ่านเมื่อ iframe ได้ focus
            iframe.addEventListener("focus", sendMessage);
        };

        // iOS Safari Fix: ใช้ touchend เพื่อ trigger บันทึกรหัสผ่าน
        document.addEventListener("touchend", sendMessage);

        // ใช้ requestAnimationFrame เพื่อให้ Safari เรนเดอร์เร็วขึ้น
        requestAnimationFrame(() => {
            sendMessage();
        });
    </script>
</body>
</html>
